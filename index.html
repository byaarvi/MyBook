<!DOCTYPE html>
<html lang="en">
<head>
<meta charset="UTF-8">
<title>My Book Flipbook</title>
<style>
  body {
    margin:0;
    background:#ccc;
    display:flex;
    justify-content:center;
    align-items:center;
    height:100vh;
  }
  #flipbook {
    /* Width relative to screen, height based on 6:9 ratio */
    width:80vw;
    height: calc(80vw * 9 / 6);
    perspective: 2000px;
  }
  #flipbook .page {
    background:white;
    box-shadow:0 0 10px rgba(0,0,0,0.3);
    overflow:hidden;
  }
  #flipbook canvas {
    display:block;
    width:100%;
    height:100%;
  }
</style>
</head>
<body>
<div id="flipbook"></div>

<!-- jQuery -->
<script src="https://code.jquery.com/jquery-3.6.0.min.js"></script>
<!-- turn.js -->
<script src="https://cdnjs.cloudflare.com/ajax/libs/turn.js/4.1.0/turn.min.js"></script>
<!-- PDF.js -->
<script src="https://cdnjs.cloudflare.com/ajax/libs/pdf.js/2.14.305/pdf.min.js"></script>

<script>
pdfjsLib.GlobalWorkerOptions.workerSrc = 'https://cdnjs.cloudflare.com/ajax/libs/pdf.js/2.14.305/pdf.worker.min.js';

const url = 'https://byaarvi.github.io/MyBook/MyBook.pdf';
const flipbook = document.getElementById('flipbook');

pdfjsLib.getDocument(url).promise.then(pdf => {
  console.log('PDF loaded, total pages:', pdf.numPages);

  let loadedPages = 0;

  for(let i=1;i<=pdf.numPages;i++){
    const pageDiv = document.createElement('div');
    pageDiv.className = 'page';
    flipbook.appendChild(pageDiv);

    const canvas = document.createElement('canvas');
    pageDiv.appendChild(canvas);

    pdf.getPage(i).then(page=>{
      const containerWidth = pageDiv.clientWidth;
      const viewport = page.getViewport({scale:1});
      const scale = containerWidth / viewport.width;
      const scaledViewport = page.getViewport({scale: scale});

      canvas.width = scaledViewport.width;
      canvas.height = scaledViewport.height;

      page.render({canvasContext:canvas.getContext('2d'),viewport:scaledViewport})
      .promise.then(()=>{
        loadedPages++;
        if(loadedPages===pdf.numPages){
          // Initialize flipbook after all pages rendered
          $('#flipbook').turn({
            width: flipbook.clientWidth,
            height: flipbook.clientHeight,
            autoCenter: true,
            display: 'double',  // open book view
            acceleration: true
          });
        }
      });
    });
  }
}).catch(err=>console.error('PDF load error:',err));
</script>
</body>
</html>
